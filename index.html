<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>blog-code-test</title>
    <!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
    <style>
        
       
    </style>
</head>

<body>
    <script>


        function heapSort(array) {
            let length = array.length
            /* 第一个非叶子节点（叶子节点：没有子节点的节点）： n/2 -1 */
            /* 为什么从这个点开始，也是因为这是最后一个拥有子节点的父节点，其可能会发生父子节点交换 */
            const node =  Math.floor(length/2) - 1

            /* 第一步先将数组构建为堆 这里是大顶堆 */
            for (let i = node; i >= 0 ; i--) {
                maxHeap(array, i, length)
            }

            /* 第二步 将堆顶元素与堆尾元素交换 再将前 (n-1) 个数重复构建堆 */
            for (let j = length - 1; j > 0; j--) {
                swap(array, 0, j)
                /* 这里相当于把第一个叶子节点改变了，所以下面从 0 开始 重新构建堆 */
                maxHeap(array, 0, j-1)
            }

            return array
        }

        function maxHeap(array, i, length) {
            /* 左子节点 */
            let left = i*2 + 1
            /* 右子节点 */
            let right = i*2 + 2
            /* 父节点 */
            let parent = i

            /* 找出子节点中比父节点大的数进行交换 */
            if(left < length && array[left] > array[parent]) {
                parent = left
            }

            /* 这里两个条件都触发也没有关系，只要保障，一个比父节点大的子节点被移上去即可 */
            if(right < length && array[right] > array[parent]) {
                parent = right
            }

            if(parent !== i) {
                swap(array,i, parent)
                /* 表示有数据移动，所以要重排一下数据移动后,所影响到的父子节点,也就是此时的 parent 节点和其子节点 */
                maxHeap(array, parent, length)
            } 
        }

        function swap(arr, i, j) {
            var temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }

        var arr = []
        for (let i = 0; i < 100000; i++) {
            arr.push(Math.random())
        }

        console.time('s')
        heapSort(arr)
        console.timeEnd('s')

    </script>
</body>

</html>